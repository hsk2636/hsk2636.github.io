<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDA 출고/입고/재입고 프로시저 분석 | pda-procedure-analysis</title>

    <!-- 메인 스타일 재사용 -->
    <link rel="stylesheet" href="../../style.css?v=4">

    <!-- 프로젝트 전용 추가 스타일 -->
    <style>
        .project-page {
            max-width: 900px;
        }

        .project-container {
            margin-top: 24px;
            margin-bottom: 40px;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 600;
            background: #eef2ff;
            color: #3730a3;
            border: 1px solid #c7d2fe;
            margin-right: 6px;
        }

        .code-block {
            background: #0f172a;
            color: #e5e7eb;
            padding: 14px 16px;
            border-radius: 10px;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 13px;
            overflow-x: auto;
            margin-bottom: 16px;
        }

        .section-title-sub {
            font-size: 15px;
            font-weight: 700;
            margin: 18px 0 8px;
        }

        .back-link {
            display: inline-block;
            margin-top: 10px;
            font-size: 13px;
            text-decoration: none;
            color: #4f46e5;
        }
    </style>
</head>
<body>

<div class="page project-page">

    <!-- 상단 헤더 -->
    <header class="header">
        <h1>PDA 출고/입고/재입고 프로시저 분석</h1>
        <h3>pda-procedure-analysis</h3>
        <p>
            PDA 단말에서 스캔되는 출고·입고·재입고 작업을  
            Oracle PL/SQL 프로시저로 어떻게 처리하는지 정리한 프로젝트입니다.
        </p>
        <div style="margin-top:14px;">
            <span class="badge">Oracle PL/SQL</span>
            <span class="badge">PDA(Android)</span>
            <span class="badge">ERP Interface</span>
        </div>
    </header>

    <main class="project-container">

        <!-- 1. 개요 -->
        <section>
            <h2 class="section-title">프로젝트 개요</h2>
            <p class="text-body">
                이 프로젝트는 현장 PDA에서 발생하는
                <b>출고(Ship)</b>, <b>입고(Receive)</b>, <b>재입고(Re-Receive)</b> 작업을  
                PL/SQL 프로시저로 처리하는 구조를 분석한 결과를 정리한 것입니다.
                <br><br>
                각 프로시저는 공통적으로
                <b>LOT 상태 변경</b>, <b>수불 이력 기록</b>, <b>ERP 인터페이스 테이블 적재</b>를 수행하며,  
                <b>IN/OUT 파라미터</b>와 <b>예외 처리 패턴</b>을 통일된 구조로 사용하는 것이 특징입니다.
            </p>
        </section>

        <!-- 2. 파일 구성 -->
        <section>
            <h2 class="section-title">파일 구성</h2>

            <div class="code-block">
<pre>pda-procedure-analysis/
 ├─ 01_ship_register.sql        -- 출고 등록 프로시저 (예: USP_M20_F01_011_01)
 ├─ 02_ship_cancel.sql          -- 출고 취소 프로시저 (예: USP_M20_F01_011_02)
 ├─ 03_rereceive_register.sql   -- 재입고 등록 프로시저 (예: USP_M20_F01_013_01)
 ├─ 04_rereceive_cancel.sql     -- 재입고 취소 프로시저 (예: USP_M20_F01_013_02)
 └─ README.md                   -- 전체 흐름 + 파라미터 설명 문서</pre>
            </div>
        </section>

        <!-- 3. 핵심 프로시저 구조 -->
        <section>
            <h2 class="section-title">핵심 프로시저 공통 구조</h2>

            <div class="section-title-sub">1) 공통 헤더 (IN/OUT 파라미터)</div>
            <div class="code-block">
<pre><code>CREATE OR REPLACE PROCEDURE usp_pda_ship_register (
      p_site_id        IN  NUMBER
    , p_lot_no         IN  VARCHAR2
    , p_ship_type      IN  VARCHAR2  -- MOV / ETC / SAL 등
    , p_ship_qty       IN  NUMBER
    , p_user_id        IN  VARCHAR2
    , p_message        OUT VARCHAR2
) IS
BEGIN
    -- 본문은 아래 단계별로 구현
    NULL;
END usp_pda_ship_register;
/</code></pre>
            </div>

            <p class="text-body">
                모든 PDA 프로시저는 위와 같이 <b>사이트, LOT, 수량, 사용자</b>를 IN으로 받고,  
                처리 결과 메시지를 <b>OUT 파라미터</b>로 반환하는 형태를 기본으로 합니다.
            </p>

            <div class="section-title-sub">2) LOT 상태 변경 + 이력 기록 패턴</div>
            <div class="code-block">
<pre><code>BEGIN
    -- 1. LOT 상태 검증
    SELECT lot_status
      INTO v_lot_status
      FROM tb_lot_mst
     WHERE lot_no = p_lot_no
       FOR UPDATE;

    IF v_lot_status &lt;&gt; 'READY' THEN
        p_message := 'ERROR: 출고 가능한 상태가 아닙니다.';
        RETURN;
    END IF;

    -- 2. LOT 상태 변경
    UPDATE tb_lot_mst
       SET lot_status = 'SHIPPED'
         , ship_date  = SYSDATE
     WHERE lot_no = p_lot_no;

    -- 3. 수불 이력 기록
    INSERT INTO tb_lot_txn_hist (
          site_id, lot_no, txn_type, txn_qty, txn_user, txn_date
    ) VALUES (
          p_site_id, p_lot_no, 'SHIP', p_ship_qty, p_user_id, SYSDATE
    );</code></pre>
            </div>

            <p class="text-body">
                출고, 재입고 모두 <b>LOT 상태 변경</b>과 <b>이력 테이블 기록</b>이라는 공통 단계를 갖고 있으며,  
                <b>txn_type</b> 값만 <code>'SHIP'</code>, <code>'RE-RECV'</code> 등으로 달라지는 형태입니다.
            </p>

            <div class="section-title-sub">3) ERP 인터페이스 테이블 적재</div>
            <div class="code-block">
<pre><code>    -- 4. ERP 인터페이스 테이블 적재 예시
    INSERT INTO erp_fg_if (
          if_id, site_id, lot_no, ship_type, ship_qty, if_flag, create_date
    ) VALUES (
          erp_fg_if_seq.NEXTVAL,
          p_site_id,
          p_lot_no,
          p_ship_type,
          p_ship_qty,
          'N',          -- 미전송 상태
          SYSDATE
    );

    p_message := 'OK';
EXCEPTION
    WHEN OTHERS THEN
        p_message := 'ERROR: ' || SQLERRM;
        ROLLBACK;
END;</code></pre>
            </div>

            <p class="text-body">
                ERP 연동은 보통 <b>인터페이스 테이블(Interface Table)</b>에 먼저 적재한 뒤,  
                배치(Job)나 별도 프로시저에서 실제 ERP로 전송하는 구조로 설계되어 있습니다.
            </p>
        </section>

        <!-- 4. 분석 포인트 -->
        <section>
            <h2 class="section-title">분석 포인트</h2>
            <ul class="text-body">
                <li>출고 / 재입고 / 취소 프로시저가 <b>같은 패턴의 IN/OUT 파라미터</b>를 사용하는지 확인</li>
                <li><b>LOT 상태 변경 순서</b>와 <b>이력 테이블(txn_hist) 기록 순서</b>를 비교하여 공통 패턴 도출</li>
                <li>ERP 인터페이스 테이블 컬럼과 PDA 입력 값이 어떻게 매핑되는지 정리</li>
                <li>에러 발생 시 <b>ROLLBACK + 메시지 반환</b> 구조가 일관되게 구현되어 있는지 체크</li>
            </ul>
        </section>

        <!-- 5. GitHub / 뒤로가기 -->
        <section>
            <h2 class="section-title">GitHub 레포지토리</h2>
            <p class="text-body">
                실제 프로시저 소스와 분석 노트는 아래 GitHub 저장소에 정리되어 있습니다.
            </p>
            <p class="text-body">
                <a href="https://github.com/hsk2636/pda-procedure-analysis"
                   class="project-link project-link-github"
                   target="_blank" rel="noopener noreferrer">
                    GitHub에서 보기
                </a>
            </p>

            <a href="../../index.html" class="back-link">← 메인 포트폴리오로 돌아가기</a>
        </section>

    </main>
</div>

</body>
</html>
